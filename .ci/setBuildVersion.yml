variables:
  patchIteration: 0 # Bump up this value to reset patch to 0
  patch: $[counter(variables['patchIteration'], 0)]

steps:
- pwsh: |
      $psdFileObj = Import-PowerShellDataFile ${{ variables.moduleFolderName }}/${{ variables.moduleFolderName }}.psd1
      $manifestVersionAsArray = $psdFileObj.ModuleVersion -split "\."
      $MAJOR = $manifestVersionAsArray[0]
      $minor = $manifestVersionAsArray[1]
      $updatedBuildVersion = $MAJOR.$minor.${{ variables.patch }}
      Write-Host "---- Setting Build Version to $updatedBuildVersion ----"
      Write-Host "##vso[build.updatebuildnumber]$updatedBuildVersion"
  displayName: Set Build Version from Module Manifest